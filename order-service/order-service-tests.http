### ПОЛНЫЙ ТЕСТ ORDER-SERVICE ЧЕРЕЗ GATEWAY (порт 8080)

### 1. Публичные эндпоинты
GET http://localhost:8080/api/restaurants

### 
GET http://localhost:8080/api/dishes

### 2. Корзина покупок
### 2.1 Получить корзину
GET http://localhost:8080/api/cart
X-User-Id: 16
X-User-Name: test@test.com

### 2.2 Добавить товар в корзину
POST http://localhost:8080/api/cart/items
X-User-Id: 16
X-User-Name: test@test.com
Content-Type: application/json

{
  "dishId": 201,
  "dishName": "Пицца Маргарита",
  "quantity": 2,
  "price": 1800,
  "restaurantId": 101
}

### 2.3 Добавить второй товар
POST http://localhost:8080/api/cart/items
X-User-Id: 16
X-User-Name: test@test.com
Content-Type: application/json

{
  "dishId": 202,
  "dishName": "Салат Цезарь",
  "quantity": 1,
  "price": 900,
  "restaurantId": 101
}

### 2.4 Проверить корзину с товарами
GET http://localhost:8080/api/cart
X-User-Id: 16
X-User-Name: test@test.com

### 2.5 Очистить корзину
DELETE http://localhost:8080/api/cart
X-User-Id: 16
X-User-Name: test@test.com

### 3. Заказы
### 3.1 Создать заказ
POST http://localhost:8080/api/orders
X-User-Id: 16
X-User-Name: test@test.com
Content-Type: application/json

{
  "restaurantId": 101,
  "items": [
    {
      "dishId": 201,
      "quantity": 2,
      "dishName": "Пицца Маргарита",
      "price": 1800
    },
    {
      "dishId": 202,
      "quantity": 1,
      "dishName": "Салат Цезарь",
      "price": 900
    }
  ],
  "totalPrice": 4500,
  "deliveryAddress": "ул. Примерная, д. 10",
  "paymentMethod": "CREDIT_CARD"
}

> {%
    if (response.status === 201) {
        client.global.set("order_id", response.body.orderId || response.body.id);
        client.log("Заказ создан с ID: " + client.global.get("order_id"));
    }
%}

### 3.2 Получить заказ по ID
GET http://localhost:8080/api/orders/{{order_id}}
X-User-Id: 16
X-User-Name: test@test.com

### 3.3 Получить все заказы пользователя
GET http://localhost:8080/api/orders/user
X-User-Id: 16
X-User-Name: test@test.com

### 3.4 Обновить статус заказа
PATCH http://localhost:8080/api/orders/{{order_id}}/status
X-User-Id: 16
X-User-Name: test@test.com
Content-Type: application/json

{
  "status": "CONFIRMED"
}

### 3.5 Отменить заказ
PATCH http://localhost:8080/api/orders/{{order_id}}/cancel
X-User-Id: 16
X-User-Name: test@test.com

### 4. Оплата
### 4.1 Создать платеж
POST http://localhost:8080/api/orders/{{order_id}}/payment
X-User-Id: 16
X-User-Name: test@test.com
Content-Type: application/json

{
  "method": "CREDIT_CARD",
  "amount": 4500,
  "cardNumber": "4111111111111111",
  "expiryDate": "12/25",
  "cvv": "123"
}

### 5. Health checks
GET http://localhost:8080/api/health/order
GET http://localhost:8080/api/health/user
GET http://localhost:8080/api/health/restaurant

### 6. Аутентификация (если нужно)
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "email": "sdiugfaiusgdf@ojsj.com",
  "password": "sdiugfaiusgdf@ojsj.com"
}

> {%
    if (response.status === 200) {
        client.global.set("jwt_token", response.body.accessToken);
        client.log("JWT токен получен");
    }
%}

### 7. Тест с JWT токеном (если JwtFilter настроен)
GET http://localhost:8080/api/cart
Authorization: Bearer {{jwt_token}}

### 8. Интеграционный тест: Корзина -> Заказ
### 8.1 Добавить в корзину
POST http://localhost:8080/api/cart/items
X-User-Id: 16
X-User-Name: test@test.com
Content-Type: application/json

{
  "dishId": 201,
  "quantity": 3,
  "price": 1800,
  "restaurantId": 101
}

### 8.2 Создать заказ из корзины
POST http://localhost:8080/api/orders/from-cart
X-User-Id: 16
X-User-Name: test@test.com
Content-Type: application/json

{
  "deliveryAddress": "ул. Интеграционная, д. 1",
  "paymentMethod": "CASH_ON_DELIVERY"
}

### 9. Тест ошибок
### 9.1 Создать заказ с некорректными данными
POST http://localhost:8080/api/orders
X-User-Id: 16
Content-Type: application/json

{
  "restaurantId": -1,
  "items": [],
  "totalPrice": -100
}

### 9.2 Получить несуществующий заказ
GET http://localhost:8080/api/orders/999999
X-User-Id: 16

### 10. Тест разных пользователей
### 10.1 Пользователь 16
GET http://localhost:8080/api/cart
X-User-Id: 16
X-User-Name: user16@test.com

### 10.2 Пользователь 17
GET http://localhost:8080/api/cart
X-User-Id: 17
X-User-Name: user17@test.com

### 11. Тест с RabbitMQ событиями (если настроено)
POST http://localhost:8080/api/orders
X-User-Id: 16
X-User-Name: test@test.com
Content-Type: application/json

{
  "restaurantId": 101,
  "items": [{"dishId": 201, "quantity": 1, "price": 1800}],
  "totalPrice": 1800,
  "sendEvent": true
}

### 12. Финальная проверка - все заказы пользователя
GET http://localhost:8080/api/orders/user
X-User-Id: 16
X-User-Name: test@test.com

> {%
    client.test("Финальная проверка", function() {
        client.assert(response.status === 200, "Статус должен быть 200");
        if (Array.isArray(response.body)) {
            client.log("Всего заказов: " + response.body.length);
            response.body.forEach((order, index) => {
                client.log(`Заказ ${index + 1}: ID=${order.id}, Статус=${order.status}, Цена=${order.totalPrice}`);
            });
        }
    });
%}